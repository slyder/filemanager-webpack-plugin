{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["const cpr = require('cpr');\nconst rimraf = require('rimraf');\nconst mv = require('mv');\n\nclass FileManagerPlugin {\n\n  constructor(options) {\n\n    this.options = this.setOptions(options);\n    this.isWin = /^win/.test(process.platform);\n\n    /* cpr options */\n    this.cprOptions = {\n      deleteFirst: true,\n      overwrite: true,\n      confirm: true\n    };\n\n  }\n\n  setOptions(userOptions) {\n\n    const defaultOptions = {\n      verbose: false,\n      onStart: {},\n      onEnd: {}\n    };\n\n    for (const key in defaultOptions) {\n      if (userOptions.hasOwnProperty(key)) {\n        defaultOptions[key] = userOptions[key];\n      }\n    }\n\n    return defaultOptions;\n\n  }\n\n  parseFileOptions(options) {\n\n    const optKeys = Object.keys(options);\n\n    for (let i = 0; i < optKeys.length; i++) {\n\n      const fileAction = optKeys[i];\n      const fileOptions = options[fileAction];\n\n      switch (fileAction) {\n\n        case 'copy':\n          fileOptions.forEach(command => {\n            if (!command.source || !command.destination) return;\n\n            const cprOptions = Object.assign({}, this.cprOptions, { filter: command.filter });\n\n            cpr(command.source, command.destination, cprOptions, (err, files) => {\n              console.error(err);\n            });\n          });\n          break;\n\n\n        case 'move':\n          fileOptions.forEach(command => {\n            if (!command.source || !command.destination) return;\n\n            mv(command.source, command.destination, (err) => {\n              console.error(err);\n            });\n          });\n          break;\n\n        case 'delete':\n          fileOptions.forEach(path => {\n            rimraf(path, {}, (response) => {\n              // handle error\n            });\n          });\n          break;\n\n        default:\n          break;\n\n      }\n\n    }\n\n  }\n\n  apply(compiler) {\n\n    compiler.plugin(\"compilation\", (comp) => {\n\n      if (this.options.verbose) {\n        console.log(\"FileManagerPlugin: onStart\");\n      }\n\n      if (this.options.onStart && Object.keys(this.options.onStart).length) {\n        this.parseFileOptions(this.options.onStart);\n      }\n\n    });\n\n    compiler.plugin('after-emit', (compliation, callback) => {\n\n      if (this.options.verbose) {\n        console.log(\"FileManagerPlugin: onEnd\");\n      }\n\n      if (this.options.onEnd && Object.keys(this.options.onEnd).length) {\n        this.parseFileOptions(this.options.onEnd);\n      }\n\n    });\n\n  }\n\n}\n\nexport default FileManagerPlugin;\n"],"names":["cpr","require","rimraf","mv","FileManagerPlugin","options","setOptions","isWin","test","process","platform","cprOptions","userOptions","defaultOptions","key","hasOwnProperty","optKeys","Object","keys","i","length","fileAction","fileOptions","forEach","command","source","destination","assign","filter","err","files","error","path","response","compiler","plugin","comp","verbose","log","onStart","parseFileOptions","compliation","callback","onEnd"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,MAAMC,QAAQ,KAAR,CAAZ;AACA,IAAMC,SAASD,QAAQ,QAAR,CAAf;AACA,IAAME,KAAKF,QAAQ,IAAR,CAAX;;IAEMG;6BAEQC,OAAZ,EAAqB;;;;SAEdA,OAAL,GAAe,KAAKC,UAAL,CAAgBD,OAAhB,CAAf;SACKE,KAAL,GAAa,OAAOC,IAAP,CAAYC,QAAQC,QAApB,CAAb;;;SAGKC,UAAL,GAAkB;mBACH,IADG;iBAEL,IAFK;eAGP;KAHX;;;;;+BAQSC,aAAa;;UAEhBC,iBAAiB;iBACZ,KADY;iBAEZ,EAFY;eAGd;OAHT;;WAMK,IAAMC,GAAX,IAAkBD,cAAlB,EAAkC;YAC5BD,YAAYG,cAAZ,CAA2BD,GAA3B,CAAJ,EAAqC;yBACpBA,GAAf,IAAsBF,YAAYE,GAAZ,CAAtB;;;;aAIGD,cAAP;;;;qCAIeR,SAAS;;;UAElBW,UAAUC,OAAOC,IAAP,CAAYb,OAAZ,CAAhB;;WAEK,IAAIc,IAAI,CAAb,EAAgBA,IAAIH,QAAQI,MAA5B,EAAoCD,GAApC,EAAyC;;YAEjCE,aAAaL,QAAQG,CAAR,CAAnB;YACMG,cAAcjB,QAAQgB,UAAR,CAApB;;gBAEQA,UAAR;;eAEO,MAAL;wBACcE,OAAZ,CAAoB,mBAAW;kBACzB,CAACC,QAAQC,MAAT,IAAmB,CAACD,QAAQE,WAAhC,EAA6C;;kBAEvCf,aAAaM,OAAOU,MAAP,CAAc,EAAd,EAAkB,MAAKhB,UAAvB,EAAmC,EAAEiB,QAAQJ,QAAQI,MAAlB,EAAnC,CAAnB;;kBAEIJ,QAAQC,MAAZ,EAAoBD,QAAQE,WAA5B,EAAyCf,UAAzC,EAAqD,UAACkB,GAAD,EAAMC,KAAN,EAAgB;wBAC3DC,KAAR,CAAcF,GAAd;eADF;aALF;;;eAYG,MAAL;wBACcN,OAAZ,CAAoB,mBAAW;kBACzB,CAACC,QAAQC,MAAT,IAAmB,CAACD,QAAQE,WAAhC,EAA6C;;iBAE1CF,QAAQC,MAAX,EAAmBD,QAAQE,WAA3B,EAAwC,UAACG,GAAD,EAAS;wBACvCE,KAAR,CAAcF,GAAd;eADF;aAHF;;;eASG,QAAL;wBACcN,OAAZ,CAAoB,gBAAQ;qBACnBS,IAAP,EAAa,EAAb,EAAiB,UAACC,QAAD,EAAc;;eAA/B;aADF;;;;;;;;;;;0BAgBFC,UAAU;;;eAELC,MAAT,CAAgB,aAAhB,EAA+B,UAACC,IAAD,EAAU;;YAEnC,OAAK/B,OAAL,CAAagC,OAAjB,EAA0B;kBAChBC,GAAR,CAAY,4BAAZ;;;YAGE,OAAKjC,OAAL,CAAakC,OAAb,IAAwBtB,OAAOC,IAAP,CAAY,OAAKb,OAAL,CAAakC,OAAzB,EAAkCnB,MAA9D,EAAsE;iBAC/DoB,gBAAL,CAAsB,OAAKnC,OAAL,CAAakC,OAAnC;;OAPJ;;eAYSJ,MAAT,CAAgB,YAAhB,EAA8B,UAACM,WAAD,EAAcC,QAAd,EAA2B;;YAEnD,OAAKrC,OAAL,CAAagC,OAAjB,EAA0B;kBAChBC,GAAR,CAAY,0BAAZ;;;YAGE,OAAKjC,OAAL,CAAasC,KAAb,IAAsB1B,OAAOC,IAAP,CAAY,OAAKb,OAAL,CAAasC,KAAzB,EAAgCvB,MAA1D,EAAkE;iBAC3DoB,gBAAL,CAAsB,OAAKnC,OAAL,CAAasC,KAAnC;;OAPJ;;;;;;;;"}